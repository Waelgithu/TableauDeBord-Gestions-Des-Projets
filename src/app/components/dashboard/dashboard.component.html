<div class="dashboard-container">
  <div class="sidebar">
    <h3>Projets :</h3>
    <ul>
      <li *ngFor="let project of projects" (click)="selectProject(project)">
        {{ project.nom }}
      </li>
    </ul>
  </div>
  <div class="main-content">
    <div class="total-budget">
      <h4>Budget Total de tous les projets</h4>
      <p>{{ totalBudget }}</p>
    </div>
    <div class="status-pie-chart">
      <h4>Répartition des Statuts des Projets</h4>
      <div class="pie-chart">
        <div class="pie-segment" style="--offset: 0; --size: {{ statusCounts['EN_COURS'] || 0 }};"></div>
        <div class="pie-segment" style="--offset: calc(100% * ({{ statusCounts['EN_COURS'] || 0 }} / 100)); --size: {{ statusCounts['ANNULE_ET_CLOTURE'] || 0 }};"></div>
        <div class="pie-segment" style="--offset: calc(100% * ({{ statusCounts['EN_COURS'] || 0 }} + {{ statusCounts['ANNULE_ET_CLOTURE'] || 0 }} / 100)); --size: {{ statusCounts['LIVRE_ET_CLOTURE'] || 0 }};"></div>
        <div class="pie-segment" style="--offset: calc(100% * ({{ statusCounts['EN_COURS'] || 0 }} + {{ statusCounts['ANNULE_ET_CLOTURE'] || 0 }} + {{ statusCounts['LIVRE_ET_CLOTURE'] || 0 }} / 100)); --size: {{ statusCounts['LIVRE'] || 0 }};"></div>
        <div class="pie-segment" style="--offset: calc(100% * ({{ statusCounts['EN_COURS'] || 0 }} + {{ statusCounts['ANNULE_ET_CLOTURE'] || 0 }} + {{ statusCounts['LIVRE_ET_CLOTURE'] || 0 }} + {{ statusCounts['LIVRE'] || 0 }} / 100)); --size: {{ statusCounts['NON_DEMARRE'] || 0 }};"></div>
        <div class="pie-segment" style="--offset: calc(100% * ({{ statusCounts['EN_COURS'] || 0 }} + {{ statusCounts['ANNULE_ET_CLOTURE'] || 0 }} + {{ statusCounts['LIVRE_ET_CLOTURE'] || 0 }} + {{ statusCounts['LIVRE'] || 0 }} + {{ statusCounts['NON_DEMARRE'] || 0 }} / 100)); --size: {{ statusCounts['EN_ATTENTE'] || 0 }};"></div>
      </div>
    </div>
    <div *ngIf="selectedProject">
      <h2>{{ selectedProject.nom }}</h2>
      <p>{{ selectedProject.description }}</p>
      <div class="charts">
        <div class="chart">
          <h4>Budget Total</h4>
          <p>{{ selectedProject.budget }}</p>
        </div>
        <div class="chart">
          <h4>Budget Consommé</h4>
        </div>
        <div class="chart">
          <h4>Task Completion</h4>
        </div>
      </div>
      <div class="project-details">
        <h4>Equipes</h4>
        <table class="table">
          <thead>
            <tr>
              <th>#</th>
              <th>Username</th>
              <th>Email</th>
              <th>Role</th>
              <th>Grade</th>
              <th>Worken</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of selectedProjectUsers">
              <td>{{ user.id }}</td>
              <td>{{ user.username }}</td>
              <td>{{ user.email }}</td>
              <td>{{ user.role }}</td>
              <td>{{ user.grade }}</td>
              <td>{{ user.worken ? 'Yes' : 'No' }}</td>
              <td><button (click)="viewDetails(user)">Details</button></td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="project-tasks">
        <h4>Tasks</h4>
        <table class="table">
          <thead>
            <tr>
              <th>#</th>
              <th>Title</th>
              <th>Description</th>
              <th>Status</th>
              <th>Start Date</th>
              <th>End Date</th>
              <th>Priority</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let task of selectedProjectTasks">
              <td>{{ task.id }}</td>
              <td>{{ task.title }}</td>
              <td>{{ task.description }}</td>
              <td>{{ task.status }}</td>
              <td>{{ task.startDate | date }}</td>
              <td>{{ task.endDate | date }}</td>
              <td>{{ task.priority }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="progress-stats">
        <h4>Aperçu des statuts des tâches</h4>
      </div>
    </div>
  </div>
</div>
